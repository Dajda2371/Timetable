<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Config Editor</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 800px; margin: auto; }
        .section { margin-bottom: 20px; }
        input, select { margin: 5px 0; padding: 8px; width: 100%; }
        button { padding: 10px; background: blue; color: white; border: none; cursor: pointer; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Config Editor</h1>
        
        <div class="section" id="teachers-section">
            <h2>Teachers</h2>
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Subjects</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="teachers-list"></tbody>
            </table>
            <button id="add-teacher">Add Teacher</button>
        </div>

        <div class="section" id="classes-section">
            <h2>Classes</h2>
            <table>
                <thead>
                    <tr>
                        <th>Grade</th>
                        <th>Class Name</th>
                        <th>Class Teacher</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="classes-list"></tbody>
            </table>
            <button id="add-class">Add Class</button>
        </div>
        
        <button id="save-config">Save Config</button>
    </div>
    
    <script>
        let config = {};

        async function loadConfig() {
            try {
                const response = await fetch("config.json");
                if (!response.ok) throw new Error("Failed to load config.json");
                config = await response.json();
                renderTeachers();
                renderClasses();
            } catch (error) {
                console.error("Error loading config:", error);
            }
        }

        function renderTeachers() {
            const teachersList = document.getElementById("teachers-list");
            teachersList.innerHTML = "";
            config.teachers.forEach((teacher, index) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td><input type="text" value="${teacher.name}" onchange="updateTeacher(${index}, 'name', this.value)"></td>
                    <td><input type="text" value="${teacher.subjects.join(', ')}" onchange="updateTeacher(${index}, 'subjects', this.value.split(', '))"></td>
                    <td><button onclick="removeTeacher(${index})">Remove</button></td>
                `;
                teachersList.appendChild(row);
            });
        }

        function addTeacher() {
            config.teachers.push({ name: "", subjects: [] });
            renderTeachers();
        }

        function updateTeacher(index, field, value) {
            config.teachers[index][field] = value;
        }

        function removeTeacher(index) {
            config.teachers.splice(index, 1);
            renderTeachers();
        }

        function renderClasses() {
            const classesList = document.getElementById("classes-list");
            classesList.innerHTML = "";
            config.classes.forEach((cls, index) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td><input type="text" value="${cls.grade}" onchange="updateClass(${index}, 'grade', this.value)"></td>
                    <td><input type="text" value="${cls.class_name}" onchange="updateClass(${index}, 'class_name', this.value)"></td>
                    <td><input type="text" value="${cls.class_teacher}" onchange="updateClass(${index}, 'class_teacher', this.value)"></td>
                    <td><button onclick="removeClass(${index})">Remove</button></td>
                `;
                classesList.appendChild(row);
            });
        }

        function addClass() {
            config.classes.push({ grade: "", class_name: "", class_teacher: "" });
            renderClasses();
        }

        function updateClass(index, field, value) {
            config.classes[index][field] = value;
        }

        function removeClass(index) {
            config.classes.splice(index, 1);
            renderClasses();
        }

        function saveConfig() {
            console.log("Saving config:", JSON.stringify(config, null, 2));
            alert("Changes saved to console. Implement file saving logic on backend.");
        }

        document.getElementById("add-teacher").addEventListener("click", addTeacher);
        document.getElementById("add-class").addEventListener("click", addClass);
        document.getElementById("save-config").addEventListener("click", saveConfig);

        loadConfig();
    </script>
</body>
</html>